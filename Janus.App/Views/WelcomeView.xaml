<UserControl x:Class="Janus.App.WelcomeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
            d:DesignHeight="300" d:DesignWidth="600">

  <UserControl.Resources>
    <ControlTemplate x:Key="JanusLogoIcon" TargetType="Control">
      <Viewbox>
        <Canvas Width="256" Height="256">
          <Ellipse Canvas.Left="8" Canvas.Top="8" Width="240" Height="240" Fill="#f5f5f5" Stroke="#222222" StrokeThickness="8"/>
          <Path Data="M64 128c0-35 29-64 64-64s64 29 64 64-29 64-64 64-64-29-64-64z" Fill="#FFFFFF" Stroke="#222222" StrokeThickness="6"/>
          <Path Data="M88 128c0-22 18-40 40-40s40 18 40 40-18 40-40 40-40-18-40-40z" Fill="#e0e0e0" Stroke="#222222" StrokeThickness="4"/>
          <!-- CORRECTED: StrokeLineCap replaced with StrokeStartLineCap and StrokeEndLineCap -->
          <Path Data="M128 128 L 128 88" Stroke="#222222" StrokeThickness="6" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
          <Path Data="M128 128 L 156 140" Stroke="#222222" StrokeThickness="6" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
          <Path Data="M56 128c0-40 32-72 72-72" Stroke="#888888" StrokeThickness="4" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
          <Path Data="M200 128c0-40-32-72-72-72" Stroke="#888888" StrokeThickness="4" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
          <Ellipse Canvas.Left="62" Canvas.Top="88" Width="20" Height="32" Fill="#FFFFFF" Stroke="#222222" StrokeThickness="3"/>
          <Ellipse Canvas.Left="174" Canvas.Top="88" Width="20" Height="32" Fill="#FFFFFF" Stroke="#222222" StrokeThickness="3"/>
          <Ellipse Canvas.Left="69" Canvas.Top="105" Width="6" Height="6" Fill="#222222"/>
          <Ellipse Canvas.Left="181" Canvas.Top="105" Width="6" Height="6" Fill="#222222"/>
          <Path Data="M60 144c4 8 12 16 24 16" Stroke="#222222" StrokeThickness="3" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
          <Path Data="M196 144c-4 8-12 16-24 16" Stroke="#222222" StrokeThickness="3" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
        </Canvas>
      </Viewbox>
    </ControlTemplate>

    <Style x:Key="AnimatedGlowButtonStyle" TargetType="Button">
      <!-- Default property values -->
      <Setter Property="Background" Value="#f3f5f7"/>
      <Setter Property="Foreground" Value="#222"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="BorderBrush" Value="#b0b4b8"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Width" Value="200"/>
      <Setter Property="Height" Value="44"/>

      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <!-- Essential: Allows the glow to render outside the button's bounds. -->
            <Grid ClipToBounds="False">

              <!-- LAYER 1: The Light Source. -->
              <Canvas>
                <!-- The glint element. RenderTransformOrigin is key for centered rotation. -->
                <Rectangle x:Name="Glint" Width="50" Height="12" Fill="PaleVioletRed" RenderTransformOrigin="0.5,0.5">
                  <Rectangle.RenderTransform>
                    <RotateTransform Angle="0"/>
                  </Rectangle.RenderTransform>
                  <Rectangle.Effect>
                    <BlurEffect Radius="12"/>
                  </Rectangle.Effect>
                </Rectangle>
              </Canvas>

              <!-- LAYER 2: The Button Chrome (Mask) -->
              <Border x:Name="buttonChrome" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="3" SnapsToDevicePixels="True">
                <ContentPresenter x:Name="contentPresenter" Focusable="False" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" RecognizesAccessKey="True" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
              </Border>
            </Grid>

            <ControlTemplate.Triggers>
              <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Self}}" Value="True">
                <DataTrigger.EnterActions>
                  <BeginStoryboard Name="GlowAnimation">
                    <!-- Longer duration for a more deliberate and detailed animation -->
                    <Storyboard RepeatBehavior="Forever" Duration="0:0:8" SpeedRatio="0.66">

                      <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Glint" Storyboard.TargetProperty="(Canvas.Left)">
                        <SplineDoubleKeyFrame KeyTime="0:0:0" Value="0" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:2" Value="155" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:4" Value="155" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:6" Value="-6" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:8" Value="0" KeySpline="0.5,0 0.5,1" />
                      </DoubleAnimationUsingKeyFrames>
                      <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Glint" Storyboard.TargetProperty="(Canvas.Top)">
                        <SplineDoubleKeyFrame KeyTime="0:0:0" Value="-2" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:1" Value="0" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:2" Value="6" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:4" Value="32" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:6" Value="34" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:8" Value="-2" KeySpline="0.5,0 0.5,1" />
                      </DoubleAnimationUsingKeyFrames>

                      <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Glint" Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)">
                        <SplineDoubleKeyFrame KeyTime="0:0:0"    Value="0" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:1"  Value="0" KeySpline="0.5,0 0.5,1" />

                        <SplineDoubleKeyFrame KeyTime="0:0:2"    Value="-15" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:3"    Value="0" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:4" Value="15" KeySpline="0.5,0 0.5,1" />

                        <SplineDoubleKeyFrame KeyTime="0:0:5"  Value="0" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:6"    Value="-15" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:7"    Value="0" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:7.33"    Value="15" KeySpline="0.5,0 0.5,1" />
                        <SplineDoubleKeyFrame KeyTime="0:0:8"    Value="0" KeySpline="0.5,0 0.5,1" />
                      </DoubleAnimationUsingKeyFrames>
                    </Storyboard>
                  </BeginStoryboard>
                </DataTrigger.EnterActions>
                <DataTrigger.ExitActions>
                  <StopStoryboard BeginStoryboardName="GlowAnimation"/>
                </DataTrigger.ExitActions>
              </DataTrigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>

      <!-- Visual state triggers for mouse interaction -->
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#e9eef3"/>
        </Trigger>
        <Trigger Property="IsPressed" Value="True">
          <Setter Property="Background" Value="#dfe4e8"/>
        </Trigger>
        <Trigger Property="IsEnabled" Value="False">
          <Setter Property="Opacity" Value="0.7"/>
        </Trigger>
      </Style.Triggers>
    </Style>
  </UserControl.Resources>
  <Grid>
    <Grid.Background>
      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
        <GradientStop Color="#f7fafd" Offset="0"/>
        <GradientStop Color="#e9eef3" Offset="1"/>
      </LinearGradientBrush>
    </Grid.Background>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    <!-- Accessibility: set minimum font size and high contrast for all text -->
    <Grid.Resources>
      <Style TargetType="TextBlock">
        <Setter Property="FontSize" Value="13"/>
        <Setter Property="Foreground" Value="#222"/>
      </Style>
      <Style TargetType="Button">
        <Setter Property="FontSize" Value="14"/>
        <Setter Property="Foreground" Value="#222"/>
        <Setter Property="Background" Value="#f3f5f7"/>
        <Setter Property="BorderBrush" Value="#b0b4b8"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding" Value="6,2"/>
        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
      </Style>
      <Style TargetType="ListBox">
        <Setter Property="FontSize" Value="13"/>
        <Setter Property="Foreground" Value="#222"/>
        <Setter Property="Background" Value="#fff"/>
        <Setter Property="BorderBrush" Value="#e0e0e0"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="KeyboardNavigation.TabNavigation" Value="Continue"/>
      </Style>
    </Grid.Resources>

    <!-- Branding: Logo and Tagline -->
    <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Center" Margin="0,32,0,16">

      <!-- Icon added here, using the ControlTemplate resource -->
      <Control Template="{StaticResource JanusLogoIcon}" Width="64" Height="64" Margin="0,0,16,0"/>

      <!-- Original text content now in a nested vertical StackPanel -->
      <StackPanel VerticalAlignment="Center">
        <TextBlock Text="Project Janus" FontSize="28" FontWeight="Bold" Foreground="#223" HorizontalAlignment="Left"/>
        <TextBlock Text="Unified Windows Event Diagnostics" FontSize="14" Foreground="#445" HorizontalAlignment="Left" Margin="0,0,0,8"/>
      </StackPanel>

    </StackPanel>
    
    <!-- Action Card -->
    <DockPanel Grid.Row="0" Margin="40,120,40,0" LastChildFill="True">
      <!-- Action Card Left-Aligned -->
      <Border Padding="24" Background="#fafbfc" BorderBrush="#e5e8eb" BorderThickness="1" Width="260" VerticalAlignment="Top">
        <StackPanel>
          <Button x:Name="NewScanButton" Content="New Live Scan" Command="{Binding NewScanCommand}" Margin="0,0,0,10" IsDefault="True"
                  Style="{StaticResource AnimatedGlowButtonStyle}"/>
          <TextBlock Text="Scan your system for recent events. This is safe and does not change anything." FontSize="12" Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,16"/>
          <Button Content="Open Snapshot..." Command="{Binding OpenSnapshotCommand}" Width="200" Height="44" Margin="0,0,0,8"
                  Background="#f3f5f7" Foreground="#222" FontWeight="Bold" BorderBrush="#b0b4b8" BorderThickness="1" Cursor="Hand"/>
          <TextBlock Text="Open a previously saved snapshot for offline analysis." FontSize="12" Foreground="#666" TextWrapping="Wrap"/>
        </StackPanel>
      </Border>
      <!-- Project Description / Quick Tutorial -->
      <StackPanel Margin="32,0,0,0" VerticalAlignment="Top">
        <TextBlock Text="Welcome to Project Janus" FontSize="22" FontWeight="Bold" Foreground="#223" Margin="0,0,0,8"/>
        <TextBlock Text="🕵️‍♂️ Analyze Windows system events around a critical timestamp." FontSize="13" Foreground="#445" TextWrapping="Wrap" Margin="0,0,0,6"/>
        <TextBlock Text="⚡ Scans are quick, safe, and non-committal—no changes are made to your system." FontSize="13" Foreground="#445" TextWrapping="Wrap" Margin="0,0,0,6"/>
        <TextBlock Text="🚀 Get started: run a new scan or open a snapshot. Snapshots are portable and can be shared for offline analysis." FontSize="13" Foreground="#445" TextWrapping="Wrap"/>
      </StackPanel>
    </DockPanel>


    <!-- Recent Snapshots Panel -->
    <Border Grid.Row="1" Margin="40" Padding="16" Background="#fafbfc" BorderBrush="#e5e8eb" BorderThickness="1">
      <DockPanel>
        <StackPanel Width="320" DockPanel.Dock="Left">
          <TextBlock Text="Recent Snapshots" FontWeight="Bold" FontSize="16" Margin="0,0,0,8"/>
          <ListBox x:Name="RecentSnapshotsListBox"
                             ItemsSource="{Binding RecentSnapshots}"
                             SelectedItem="{Binding SelectedRecentSnapshot, Mode=TwoWay}"
                             DisplayMemberPath="FileName"
                             Height="200"
                             IsTabStop="True"
                             KeyboardNavigation.TabIndex="2"
                             KeyDown="RecentSnapshotsListBox_KeyDown"
                             MouseDoubleClick="RecentSnapshotsListBox_MouseDoubleClick">
            <ListBox.Style>
              <Style TargetType="ListBox">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding RecentSnapshots.Count}" Value="0">
                    <Setter Property="Template">
                      <Setter.Value>
                        <ControlTemplate>
                          <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="24">
                            <TextBlock Text="No recent snapshots found." FontStyle="Italic" Foreground="#888" FontSize="14" Margin="0,16"/>
                            <TextBlock Text="You haven't opened or created any snapshots yet. To get started, simply run a scan and save the results." FontSize="12" Foreground="#aaa" Margin="0,0,0,8"/>
                          </StackPanel>
                        </ControlTemplate>
                      </Setter.Value>
                    </Setter>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </ListBox.Style>
          </ListBox>
        </StackPanel>
        <Separator Width="16" Visibility="Hidden"/>
        <StackPanel>
          <TextBlock Text="Snapshot Details" FontWeight="Bold" FontSize="16" Margin="0,0,0,8"/>
          <StackPanel DataContext="{Binding SelectedRecentSnapshot}">
            <TextBlock Text="{Binding FilePath}" FontWeight="SemiBold" FontSize="12" TextWrapping="Wrap"/>
            <TextBlock Text="{Binding Error}" Foreground="Red" FontSize="12"/>
            <StackPanel>
              <Grid Margin="0,8,0,0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="110"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Grid.Column="0" Text="Timestamp:" FontWeight="SemiBold"/>
                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding MetadataSession.Timestamp}"/>
                <TextBlock Grid.Row="1" Grid.Column="0" Text="Window:" FontWeight="SemiBold"/>
                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding MetadataSession.Window}"/>
                <TextBlock Grid.Row="2" Grid.Column="0" Text="Machine:" FontWeight="SemiBold"/>
                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding MetadataSession.MachineName}"/>
                <TextBlock Grid.Row="3" Grid.Column="0" Text="User Notes:" FontWeight="SemiBold"/>
                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding MetadataSession.UserNotes}" TextWrapping="Wrap"/>
                <TextBlock Grid.Row="4" Grid.Column="0" Text="Events:" FontWeight="SemiBold"/>
                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding MetadataEventCount}"/>
              </Grid>
            </StackPanel>
          </StackPanel>
          <Button Content="_Load Snapshot"
                          Width="120"
                          Height="30"
                          Margin="0,10,0,0"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Bottom"
                  Command="{Binding OpenRecentSnapshotCommand}"
                  CommandParameter="{Binding SelectedRecentSnapshot}"
                  IsEnabled="{Binding SelectedRecentSnapshot, Converter={StaticResource NullToBoolConverter}}"
                  KeyboardNavigation.TabIndex="3"/>
        </StackPanel>
      </DockPanel>
    </Border>
  </Grid>
</UserControl>
